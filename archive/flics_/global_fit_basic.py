# -*- coding: utf-8 -*-
"""
Created on Tue May 29 16:32:07 2018

@author: bar23
"""
import numpy as np
import math 
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

def cc_func(x,b,y0,v,d):
    a2,w2,a,dist,dx,tau_line = [39.27101, 0.04, 0.02472, 20, 0.03651, 0.001]
    exp1 = np.exp(-(dist*dx-v*(math.cos(a))*x)**2/(w2+0.5*a2+4*d*x))
    exp2 = np.exp(-x*x*(v*math.sin(a)-dx/tau_line)*(v*math.sin(a)-dx/tau_line)/(w2+0.5*a2+a*d*x))
    y = y0 +b*exp1*exp2/(4*d*x+w2+0.5*a2)
    return y

def get_para():
    para2 =  [39.27101, 0.04, 0.02472, 20, 0.03651, 0.001]
    return para2

def cc_func2(x,b,y0,v,d):
    a2,w2,a,dist,dx,tau_line = get_para()
    exp1 = np.exp(-(dist*dx-v*(math.cos(a))*x)**2/(w2+0.5*a2+4*d*x))
    exp2 = np.exp(-x*x*(v*math.sin(a)-dx/tau_line)*(v*math.sin(a)-dx/tau_line)/(w2+0.5*a2+a*d*x))
    y = y0 +b*exp1*exp2/(4*d*x+w2+0.5*a2)
    return y
 
fixed_para =[1, 0.04, 39.27101, 0.04, 0.02472, 20, 0.03651, 0.001]
para2 =  [39.27101, 0.04, 0.02472, 20, 0.03651, 0.001]
b= 57.16151
dist = 20
dx = 0.03651
a = 0.02472
w2=0.04
wz2=0.04
a2=39.27101
d=53.89843
v=545.0506
tau_line=0.001
y0=0.61322
s=1

xdata =[i*tau_line for i in range(51)]
ydata=[0]*len(xdata)

for x in xdata:
    y = cc_func(x,b,y0,v,d)
    pos = int(x/tau_line)
    ydata[pos]=y
res_20 =[(0, 3.3662631461852244), (1, 3.483409527589783), (2, 3.4471641807183593), (3, 3.2936178025173235), (4, 3.072192700569488), (5, 2.8244866309692567), (6, 2.5808520585850458), (7, 2.3460680332663104), (8, 2.1156282768006949), (9, 1.8956036398223404), (10, 1.6887031529238488), (11, 1.4941451899832321), (12, 1.3015445787650008), (13, 1.1268255560460727), (14, 0.97625895676041063), (15, 0.84923334450343901), (16, 0.75160136917389209), (17, 0.69010989115423282), (18, 0.64048086496969536), (19, 0.60859052515930145), (20, 0.58189338444481897), (21, 0.55689777400520657), (22, 0.54041407080599912), (23, 0.53318482346966156), (24, 0.53223524675958278), (25, 0.54733877677609755), (26, 0.57058691412678686), (27, 0.59790341313055195), (28, 0.63088705149354607), (29, 0.66230607407515019), (30, 0.69780081156261542), (31, 0.72784128999945563), (32, 0.7484101106300185), (33, 0.76427463770684012), (34, 0.77007044286969617), (35, 0.77688577693059624), (36, 0.77000181621015218), (37, 0.75857492917784575), (38, 0.74060068442324511), (39, 0.71165525689262965), (40, 0.67182839915470649), (41, 0.63031567253472975), (42, 0.58564910379651181), (43, 0.54292220056341978), (44, 0.5029956422133397), (45, 0.47153494262783102), (46, 0.44896317591816753), (47, 0.42900002617817395), (48, 0.41592875123725587), (49, 0.40778595418052904), (50, 0.40274410125877091)]
true_y =[]
for i in range(len(res_20)):
    y = res_20[i][1]
    true_y.append(y)
    
plt.plot(xdata,ydata,'r--',xdata,true_y,'b--')

# OMG itt worked!! get popt = array([ 56.51326553,   0.59670744, 520.19071225,  55.90232709])
popt, pcov = curve_fit(cc_func2, xdata, true_y,bounds=(0, [100., 1., 1000., 100.]))



